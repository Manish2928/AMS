{% extends "base.html" %}
{% block title %}Reset Password - AMS{% endblock %}
{% block content %}
<h2>Reset Password (Admin)</h2>
<form method="POST">
  {{ form.hidden_tag() }}
  <div>{{ form.email.label }} {{ form.email() }}</div>
  <div>{{ form.submit() }}</div>
</form>

{% if reset_link %}
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
    const publicKey_api = "{{ publicKey_api }}";
    const service_api = "{{ service_api }}";
    const template_api = "{{ template_api }}";

    (function(){
        emailjs.init({ publicKey: publicKey_api });
    })();

    emailjs.send(service_api, template_api, {
        email: "{{ form.email.data }}",   // maps to your EmailJS template variable {{email}}
        link: "{{ reset_link }}"          // maps to your EmailJS template variable {{link}}
    }).then(() => {
        alert("Reset link sent to email!");
    }).catch(err => {
        console.error("EmailJS error:", err);
    });
</script>
{% endif %}

<p>Check your email for reset link.</p>
{% endblock %}
